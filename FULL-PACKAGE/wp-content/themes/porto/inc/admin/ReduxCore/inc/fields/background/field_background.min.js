!function(e){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.background=redux.field_objects.background||{},redux.field_objects.background.init=function(r){r||(r=e(document).find(".redux-group-tab:visible").find(".redux-container-background:visible")),e(r).each((function(){var r=e(this),a=r;if(r.hasClass("redux-field-container")||(a=r.parents(".redux-field-container:first")),!a.is(":hidden")&&a.hasClass("redux-field-init")){a.removeClass("redux-field-init"),r.find(".redux-remove-background").unbind("click").on("click",(function(r){return r.preventDefault(),redux.field_objects.background.removeImage(e(this).parents(".redux-container-background:first")),!1})),r.find(".redux-background-upload").unbind().on("click",(function(r){redux.field_objects.background.addImage(r,e(this).parents(".redux-container-background:first"))})),r.find(".redux-background-input").on("change",(function(){redux.field_objects.background.preview(e(this))})),r.find(".redux-color").wpColorPicker({palettes:["var(--porto-primary-color)","var(--porto-secondary-color)","var(--porto-tertiary-color)","var(--porto-quaternary-color)","var(--porto-dark-color)","var(--porto-light-color)","var(--porto-primary-light-5)"],change:function(r,a){e(this).val(a.color.toString()),redux_change(e(this)),e("#"+r.target.id+"-transparency").removeAttr("checked"),redux.field_objects.background.preview(e(this))},clear:function(r,a){redux_change(e(this).parent().find(".redux-color-init")),redux.field_objects.background.preview(e(this))}}),r.find(".redux-color").on("blur",(function(){var a=e(this).val(),i="#"+e(this).attr("id");"transparent"===a?(e(this).parent().parent().find(".wp-color-result").css("background-color","transparent"),r.find(i+"-transparency").attr("checked","checked")):(colorValidate(this)===a&&0!==a.indexOf("#")&&e(this).val(e(this).data("oldcolor")),r.find(i+"-transparency").removeAttr("checked"))})),r.find(".redux-color").on("focus",(function(){e(this).data("oldcolor",e(this).val())})),r.find(".redux-color").on("keyup",(function(){var a=e(this).val(),i=colorValidate(this),t="#"+e(this).attr("id");"transparent"===a?(e(this).parent().parent().find(".wp-color-result").css("background-color","transparent"),r.find(t+"-transparency").attr("checked","checked")):(r.find(t+"-transparency").removeAttr("checked"),i&&i!==e(this).val()&&e(this).val(i))})),r.find(".color-transparency").on("click",(function(){if(e(this).is(":checked"))r.find(".redux-saved-color").val(e("#"+e(this).data("id")).val()),r.find("#"+e(this).data("id")).val("transparent"),r.find("#"+e(this).data("id")).parent().parent().find(".wp-color-result").css("background-color","transparent");else if("transparent"===r.find("#"+e(this).data("id")).val()){var a=e(".redux-saved-color").val();""===a&&(a=e("#"+e(this).data("id")).data("default-color")),r.find("#"+e(this).data("id")).parent().parent().find(".wp-color-result").css("background-color",a),r.find("#"+e(this).data("id")).val(a)}redux.field_objects.background.preview(e(this)),redux_change(e(this))}));var i={width:"resolve",triggerChange:!0,allowClear:!0},t=r.find(".select2_params");if(t.length){var d=t.val();d=JSON.parse(d),i=e.extend({},i,d)}r.find(" .redux-background-repeat, .redux-background-clip, .redux-background-origin, .redux-background-size, .redux-background-attachment, .redux-background-position").select2(i)}}))},redux.field_objects.background.preview=function(r){var a=e(r).parents(".redux-container-background:first"),i=e(a).find(".background-preview");if(i){var t=!0,d="height:"+i.height()+"px;";e(a).find(".redux-background-input").each((function(){var r=e(this).serializeArray();(r=r[0])&&-1!=r.name.indexOf("[background-")&&""!==r.value&&(t=!1,r.name=r.name.split("[background-"),r.name="background-"+r.name[1].replace("]",""),"background-image"==r.name?d+=r.name+':url("'+r.value+'");':d+=r.name+":"+r.value+";")})),t?i.slideUp():i.attr("style",d).fadeIn()}},redux.field_objects.background.addImage=function(r,a){var i;r.preventDefault();var t=e(this);i||(i=wp.media({multiple:!1,library:{},title:t.data("choose"),button:{text:t.data("update")}})).on("select",(function(){var r=i.state().get("selection").first();if(i.close(),"image"===r.attributes.type){a.find(".upload").val(r.attributes.url),a.find(".upload-id").val(r.attributes.id),a.find(".upload-height").val(r.attributes.height),a.find(".upload-width").val(r.attributes.width),redux_change(e(a).find(".upload-id"));var t=r.attributes.url;if(void 0!==r.attributes.sizes&&void 0!==r.attributes.sizes.thumbnail)t=r.attributes.sizes.thumbnail.url;else if(void 0!==r.attributes.sizes){var d=r.attributes.height;for(var n in r.attributes.sizes){var o=r.attributes.sizes[n];o.height<d&&(d=o.height,t=o.url)}}else t=r.attributes.icon;a.find(".upload-thumbnail").val(t),a.find(".upload").hasClass("noPreview")||a.find(".screenshot").empty().hide().append('<img class="redux-option-image" src="'+t+'">').slideDown("fast"),a.find(".redux-remove-background").removeClass("hide"),a.find(".redux-background-input-properties").slideDown(),redux.field_objects.background.preview(a.find(".upload"))}})),i.open()},redux.field_objects.background.removeImage=function(r){r.find(".redux-remove-background").addClass("hide")&&(r.find(".redux-remove-background").addClass("hide"),r.find(".upload").val(""),r.find(".upload-id").val(""),r.find(".upload-height").val(""),r.find(".upload-width").val(""),redux_change(e(r).find(".upload-id")),r.find(".redux-background-input-properties").hide(),r.find(".screenshot").slideUp(),r.find(".remove-file").unbind(),e(".section-upload .upload-notice").length>0&&e(".redux-background-upload").remove())}}(jQuery);